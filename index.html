<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TodoListApp</title>
    <link
      rel="stylesheet"
      href="//maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <div id="root"></div>

    <!-- REACT -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <!-- REACT FOR WEB -->
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- BABEL -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const root = document.getElementById("root");

      function TodoListApp() {
        // using useState is more practical and faster
        const [Names, setNames] = React.useState("");
        const [Phones, setPhones] = React.useState("");
        const [Emails, setEmails] = React.useState("");
        const [Contacts, setContacts] = React.useState([]);
        const [EditIndex, setEditIndex] = React.useState(null);
        const [ShowContactList, setShowContactList] = React.useState(false);
        // const [SearchContacts, setSearchContacts] = React.useState("");

        // useRef replace when we do DOM in javascript
        const NameInputRef = React.useRef(null);
        const PhoneInputRef = React.useRef(null);
        const EmailInputRef = React.useRef(null);

        // save to localStorage using method useEffect
        React.useEffect(() => {
          const storageContacts = localStorage.getItem("contacts-list");
          if (storageContacts) {
            setContacts(JSON.parse(storageContacts));
            setShowContactList(true);
          }
        }, []);

        React.useEffect(() => {
          localStorage.setItem("contacts-list", JSON.stringify(Contacts));
        }, [Contacts]);

        // // handle search
        // const filteredContacts = Contacts.filter(
        //   (contact) =>
        //     contact.Names.toLowerCase().includes(
        //       SearchContacts.toLowerCase()
        //     ) ||
        //     contact.Phones.includes(SearchContacts) ||
        //     contact.Emails.toLowerCase().includes(SearchContacts.toLowerCase())
        // );

        function onChangeName(e) {
          setNames(e.target.value);
        }

        function onChangePhone(e) {
          setPhones(e.target.value);
        }

        function onChangeEmail(e) {
          setEmails(e.target.value);
        }

        // function onSearchContacts(e) {
        //   setContacts(e.target.value);
        // }

        function RenderUI() {
          setShowContactList(true);
          if (!Names || !Phones || !Emails) {
            alert("harap isi bidang ini");
          } else if (EditIndex !== null) {
            const EditContacts = Contacts.map((contact, i) =>
              i === EditIndex
                ? { name: Names, phone: Phones, email: Emails }
                : contact
            );
            setContacts(EditContacts);
            setEditIndex(null);
          } else {
            const newContact = { name: Names, phone: Phones, email: Emails };
            setContacts([...Contacts, newContact]);
          }
        }

        function OnClickButton() {
          RenderUI();
          setNames("");
          setPhones("");
          setEmails("");
        }

        function OnClickContacts(index) {
          const UpdateContacts = Contacts.filter((_, i) => i !== index);
          setContacts(UpdateContacts);
        }

        function onEditClick(index) {
          const contactToEdit = Contacts[index];
          setNames(contactToEdit.Names);
          setNames(contactToEdit.Phones);
          setNames(contactToEdit.Emails);
          setEditIndex(index);

          NameInputRef.current.focus();
        }

        return (
          <>
            <div class="container">
              <h3 class="text-center mt-5 mb-5">Contact Manager</h3>

              <input
                type="text"
                class="form-control mb-3 w-100"
                placeholder="Search..."
                // value={SearchContacts}
                // onChange={onSearchContacts}
              />
              <div class="row">
                <div class="col-sm">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Name"
                    onChange={onChangeName}
                    value={Names}
                    ref={NameInputRef}
                  />
                </div>
                <div class="col-sm">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Telp"
                    onChange={onChangePhone}
                    value={Phones}
                    ref={PhoneInputRef}
                  />
                </div>
                <div class="col-sm">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Email"
                    onChange={onChangeEmail}
                    value={Emails}
                    ref={EmailInputRef}
                  />
                </div>
                <div class="col-sm">
                  <button class="btn btn-primary w-100" onClick={OnClickButton}>
                    <i class="bi bi-plus"></i>
                    {EditIndex !== null ? "Save" : "Add"}
                  </button>
                </div>
              </div>

              {ShowContactList && (
                <>
                  <h3 class="text-center mt-5">Contact List</h3>
                  <table class="table table-hover mt-5">
                    <thead>
                      <tr>
                        <th scope="col">
                          <i class="bi bi-person-fill mr-2"></i>Name
                        </th>
                        <th scope="col">
                          <i class="bi bi-telephone-fill mr-2"></i>Telp
                        </th>
                        <th scope="col">
                          <i class="bi bi-envelope-fill mr-2"></i>Email
                        </th>
                        <th scope="col">Action</th>
                      </tr>
                    </thead>

                    <tbody>
                      {Contacts.map((contact, index) => (
                        <tr key={index}>
                          <td>{contact.name}</td>
                          <td>{contact.phone}</td>
                          <td>{contact.email}</td>
                          <td>
                            <button
                              class="btn btn-primary btn-sm mr-2"
                              onClick={() => onEditClick(index)}
                            >
                              <i class="bi bi-pencil-square pr-1"></i>
                              Edit
                            </button>
                            <button
                              class="btn btn-danger btn-sm"
                              onClick={() => OnClickContacts(index)}
                            >
                              <i class="bi bi-trash-fill pr-1"></i>
                              Delete
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </>
              )}
            </div>
          </>
        );
      }

      function App() {
        return (
          <>
            <TodoListApp />
          </>
        );
      }
      //render react
      ReactDOM.render(<App />, root);
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
